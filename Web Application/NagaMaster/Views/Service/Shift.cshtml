@model NagaMaster.Models.Service.ShiftModel

<div class="header-container fixed-top">
    <header class="header navbar navbar-expand-sm">
        <ul class="navbar-item flex-row">
            <div class="sub-header-container">
                <header class="header navbar navbar-expand-sm">
                    <a href="javascript:void(0);" class="sidebarCollapse" data-placement="bottom">
                        <i class="las la-bars"></i>
                    </a>
                    <ul class="navbar-nav flex-row">
                        <li>
                            <div class="page-header">
                                <nav class="breadcrumb-one" aria-label="breadcrumb">
                                    <ol class="breadcrumb">
                                        <li class="breadcrumb-item active"><a href="javascript:void(0);">Services</a></li>
                                    </ol>
                                </nav>
                            </div>
                        </li>
                    </ul>
                </header>
            </div>
            <li class="heading-nav nav-item dropdown fullscreen-dropdown d-none d-lg-flex">
                @*PlantName :*@ @Request.Cookies["PlantName"].Value.ToString()
            </li>
        </ul>
        <ul class="navbar-item flex-row ml-md-auto">
            <li class="nav-item dropdown fullscreen-dropdown d-none d-lg-flex">
                <a class="nav-link full-screen-mode d-flex align-center" href="javascript:void(0);">
                    <i class="las la-compress pr-2" id="fullScreenIcon"></i>Full Display
                </a>
            </li>
            <li class="nav-item dropdown notification-dropdown">
                <a href="javascript:void(0);" class="nav-link dropdown-toggle position-relative" id="notificationDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="las la-bell"></i>
                    <div class="blink">
                        <div class="circle"></div>
                    </div>
                </a>
                <div class="dropdown-menu position-absolute" aria-labelledby="notificationDropdown">
                    <div class="nav-drop is-notification-dropdown">

                    </div>
                </div>
            </li>
            <li class="nav-item dropdown user-profile-dropdown d-flex align-items-center pr-4">
                <a href="javascript:void(0);" class="nav-link dropdown-toggle user" id="userProfileDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    <div class="d-flex flex-column text-right">
                        <span class="font-12 strong lh-normal">Welcome! @Request.Cookies["EmpDesc"].Value.ToString()</span>
                        <span class="font-11 lighter lh-normal">@Request.Cookies["RoleName"].Value.ToString()</span>
                    </div>
                    <img src="~/assets/img/new-pizza.jpg" alt="avatar">
                </a>
                <div class="dropdown-menu position-absolute" aria-labelledby="userProfileDropdown">
                    <div class="nav-drop is-account-dropdown">
                        <div class="inner">
                            <div class="nav-drop-body account-items p-0">
                                <a id="profile-link" class="account-item" href="pages_profile.html">
                                    <div class="media align-center">
                                        <div class="media-left">
                                            <div class="image">
                                                <img class="rounded-circle avatar-xs" src="~/assets/img/new-pizza.jpg" alt="">
                                            </div>
                                        </div>
                                        <div class="media-content ml-3">
                                            <h6 class="font-13 mb-0 strong">@Request.Cookies["EmpDesc"].Value.ToString()</h6>
                                            <small>@Request.Cookies["RoleName"].Value.ToString()</small>
                                        </div>
                                        <div class="media-right">
                                            <i data-feather="check"></i>
                                        </div>
                                    </div>
                                </a>
                                <a class="account-item" href="pages_profile.html">
                                    <div class="media align-center">
                                        <div class="icon-wrap">
                                            <i class="las la-user font-20"></i>
                                        </div>
                                        <div class="media-content ml-3">
                                            <h6 class="font-13 mb-0 strong">My Account</h6>
                                        </div>
                                    </div>
                                </a>
                                <a class="account-item" href="pages_timeline.html">
                                    <div class="media align-center">
                                        <div class="icon-wrap">
                                            <i class="las la-briefcase font-20"></i>
                                        </div>
                                        <div class="media-content ml-3">
                                            <h6 class="font-13 mb-0 strong">My Activity</h6>
                                        </div>
                                    </div>
                                </a>
                                <a class="account-item settings">
                                    <div class="media align-center">
                                        <div class="icon-wrap">
                                            <i class="las la-cog font-20"></i>
                                        </div>
                                        <div class="media-content ml-3">
                                            <h6 class="font-13 mb-0 strong">Settings</h6>
                                        </div>
                                    </div>
                                </a>
                                <hr class="account-divider">
                                <a class="account-item" href="~/Login/LoginPage">
                                    <div class="media align-center">
                                        <div class="icon-wrap">
                                            <i class="las la-sign-out-alt font-20"></i>
                                        </div>
                                        <div class="media-content ml-3">
                                            <h6 class="font-13 mb-0 strong ">Logout</h6>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </header>
</div>
<!-- Main Body Starts -->
<div class="layout-px-spacing">
    <div class="row layout-top-spacing">
        <div class="col-xl-12 col-lg-12 col-sm-12  layout-spacing">
            <div class="widget-content widget-content-area br-6" style="background: whitesmoke;">
                <form id="frmshift">
                    <div class="row mb-2">
                        <div class="col-sm-12">
                            <h4 class="pl-2 pt-2">Shift Details</h4>
                            <hr>
                        </div>

                    </div>

                    <div class="shiftdet-input-lane1 row">
                        <div class="col-sm-1"></div>

                        <div class="form-group col-sm-4">
                            <label class="col-form-label col-sm-12">
                                Unit Name
                            </label>
                            <div class="">
                                @Html.DropDownListFor(x => x.UnitId, new SelectList(Model.UnitDetails, "Value", "Text"), "--- SELECT ---", new { @class = "form-control", name = "UnitId", onchange = "LoadShift()" })
                            </div>
                        </div>
                        <div class="col-sm-1">

                        </div>
                        <div class="col-sm-1" style="border-left: 1px solid;">

                        </div>

                        <div class="form-group col-sm-4">
                            <label class="col-form-label col-sm-12">
                                System
                            </label>
                            <div class="">
                                @Html.DropDownListFor(x => x.SystemId, new SelectList(Model.SystemDetails, "Value", "Text"), "--- SELECT ---", new { @class = "form-control", name = "SystemId", onchange = "LoadShift()" })
                            </div>
                        </div>
                        <div class="col-sm-1"></div>
                    </div>
                    <div class="shiftdet-input-lane2 row">
                        <div class="form-group col-sm-12">
                            <hr>
                        </div>

                    </div>
                    <div class="shiftdet-input-lane3 row">
                        <div class="form-group col-sm-3">
                            <h6 style="text-align: center;display: flex; flex-direction: row;justify-content: center;align-items: center;height: 50px;">Shift 1</h6>
                        </div>
                        <div class="form-group col-sm-3">
                            <div class="form-group row">
                                <div class="col-sm-9">
                                    <input class="form-control" type="date" value="@Model.ShiftDate" id="example-date-input" name="ShiftDate">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                        </div>
                        @if (ViewBag.IsEdit == 1)
                        {
                            <div class="form-group col-sm-3">
                                <input class="btn btn-primary" id="btnOpen1" style="width: 150px;" onclick="funOpenClose(1,0)" type="button" value="Open" />
                            </div>
                            <div class="form-group col-sm-3">
                                <input class="btn btn-dark" id="btnClose1" style="width: 150px;" onclick="funOpenClose(1,1)" type="button" value="Close" />
                            </div>
                        }
                        @if (ViewBag.IsEdit == 0)
                        {
                            <div class="form-group col-sm-3">
                                <input class="btn btn-primary" id="btnOpen1" style="width: 150px;" onclick="ResError()" type="button" value="Open" />
                            </div>
                            <div class="form-group col-sm-3">
                                <input class="btn btn-dark" id="btnClose1" style="width: 150px;" onclick="ResError()" type="button" value="Close" />
                            </div>
                        }

                    </div>

                    <div class="shiftdet-input-lane4 row">
                        <div class="form-group col-sm-3">
                            <h6 style="text-align: center;display: flex; flex-direction: row;justify-content: center;align-items: center;height: 50px;">Shift 2</h6>
                        </div>
                        <div class="form-group col-sm-3">
                            <div class="form-group row">
                                <div class="col-sm-9">
                                    <input class="form-control" type="date" value="@Model.ShiftDate" id="example-date-input" name="ShiftDate">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                        </div>
                        @if (ViewBag.IsEdit == 1)
                        {
                            <div class="form-group col-sm-3">
                                <input class="btn btn-primary" id="btnOpen2" style="width: 150px;" onclick="funOpenClose(2,0)" type="button" value="Open" />
                            </div>
                            <div class="form-group col-sm-3">
                                <input class="btn btn-dark" id="btnClose2" style="width: 150px;" onclick="funOpenClose(2,1)" type="button" value="Close" />
                            </div>
                        }
                        @if (ViewBag.IsEdit == 0)
                        {
                            <div class="form-group col-sm-3">
                                <input class="btn btn-primary" id="btnOpen2" style="width: 150px;" onclick="ResError()" type="button" value="Open" />
                            </div>
                            <div class="form-group col-sm-3">
                                <input class="btn btn-dark" id="btnClose2" style="width: 150px;" onclick="ResError()" type="button" value="Close" />
                            </div>
                        }

                    </div>
                    <input type="hidden" name="ShiftId" id="ShiftId" value="" />
                    <input type="hidden" name="Type" id="Type" value="" />
                    <div class="shiftdet-input-lane5 row">
                        <div class="form-group col-sm-12">
                            <hr>
                        </div>

                    </div>
                    <div class="shiftdet-input-lane6 row">
                        <div class="form-group col-sm-4">

                        </div>
                        @if (ViewBag.IsEdit == 1)
                        {
                            <div class="form-group col-sm-4 dayclose">
                                <input class="btn btn-danger" style="align-items: center;" onclick="funDayClose()" type="button" value="Day Close" />
                            </div>
                        }
                        @if (ViewBag.IsEdit == 0)
                        {
                            <div class="form-group col-sm-4 dayclose">
                                <input class="btn btn-danger" style="align-items: center;" onclick="ResError()" type="button" value="Day Close" />
                            </div>
                        }

                        <div class="form-group col-sm-4">

                        </div>

                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- Main Body Ends -->

<script>
    function ResError() {
        toastr.error("You are not eligible for Change Shift Details");
    }

    function funOpenClose(shiftId, type) {

        $("#ShiftId").val(shiftId);
        $("#Type").val(type);

        if ($("#UnitId").val() == "")
        {
            toastr.error("Select Unit");
            return true;
        }
        else if ($("#SystemId").val() == "") {
            toastr.error("Select System");
            return true;
        }

        $.ajax({
            type: "POST",
            url: "/Service/OpenClose",
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            dataType: "json",
            data: $("#frmshift").serialize(),
            success: function (jsonData) {
                console.log(jsonData);
                if (jsonData != null) {
                    
                    if (jsonData.Status != 1)
                        toastr.error(jsonData.Message);

                    else {
                        toastr.success(jsonData.Message);
                        setTimeout(function () { location.reload(); }, 2000);
                        
                    }
                } else {
                    alert("something went wrong");
                }
            }
        });
    }

    function LoadShift()
    {
        if ($("#UnitId").val() == "") {
            return true;
        }
        else if ($("#SystemId").val() == "") {
            return true;
        }

        $.ajax({
            type: "POST",
            url: "/Service/LoadShiftDetails",
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            dataType: "json",
            data: $("#frmshift").serialize(),
            success: function (jsonData) {
                console.log(jsonData);
                if (jsonData != null) {

                    if (jsonData.Status == 1)
                    {
                        $("#btnOpen1").disabled = $("#btnOpen2").disabled = false;
                        $("#btnClose1").attr('disabled', 'disabled');
                        $("#btnClose2").attr('disabled', 'disabled');
                    }
                    else if (jsonData.Status == 2) {
                        if (jsonData.Open1 == false)
                            $("#btnOpen1").attr('disabled', 'disabled');
                        if (jsonData.Open2 == false)
                            $("#btnOpen2").attr('disabled', 'disabled');
                        if (jsonData.Close1 == false)
                            $("#btnClose1").attr('disabled', 'disabled');
                        if (jsonData.Close2 == false)
                            $("#btnClose2").attr('disabled', 'disabled');
                        //$("#btnOpen1").removeAttr('disabled');
                        //$("#btnOpen2").removeAttr('disabled');
                        //$("#btnClose1").removeAttr('disabled');
                        //$("#btnClose2").removeAttr('disabled');
                    }
                    else if (jsonData.Status == 3) {
                        if (jsonData.Open1 == false) 
                            $("#btnOpen1").attr('disabled', 'disabled');
                        if (jsonData.Open2 == false)
                            $("#btnOpen2").attr('disabled', 'disabled');
                        if (jsonData.Close1 == false)
                            $("#btnClose1").attr('disabled', 'disabled');
                        if (jsonData.Close2 == false)
                            $("#btnClose2").attr('disabled', 'disabled');
                    }
                } else {
                    alert("something went wrong");
                }
            }
        });
    }

    function funDayClose() {

        if ($("#UnitId").val() == "") {
            toastr.error("Select Unit");
            return true;
        }
        else if ($("#SystemId").val() == "") {
            toastr.error("Select System");
            return true;
        }

        $.ajax({
            type: "POST",
            url: "/Service/Dayclose",
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            dataType: "json",
            data: $("#frmshift").serialize(),
            success: function (jsonData) {
                console.log(jsonData);
                if (jsonData != null) {

                    if (jsonData.Status != 1)
                        toastr.error(jsonData.Message);

                    else {
                        toastr.success(jsonData.Message);
                        setTimeout(function () { location.reload(); }, 2000);

                    }
                } else {
                    alert("something went wrong");
                }
            }
        });
    }
</script>
